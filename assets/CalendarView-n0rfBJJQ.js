import{g as r,d as K,m as J,w as E,a as n,N as Ue,b as S,f as M,o as i,_ as Z,c as _,F as G,h as L,e as ce,J as v,S as xe,u as V,p as oe,K as ne,T as Oe,r as Fe,H as Ae,U as qe,I as Be}from"./index-D5djcD_c.js";import{E as ge,a as De,i as W}from"./ErrorPopup-C9TM_HDh.js";import{S as F}from"./StyledButton-YEnEYvQZ.js";import{P as _e}from"./PopUpComponent-BgRgWAft.js";import{M as Ge}from"./MessagePopup-Bo0jDfEz.js";import"./ErrorMessage-BUaYKp2C.js";function he(P=50){const g=r(0),y=r(0),m=r(0),l=r(0),a=p=>{g.value=p.touches[0].clientX,y.value=p.touches[0].clientY},c=p=>{m.value=p.changedTouches[0].clientX,l.value=p.changedTouches[0].clientY;const T=b();return T&&p.preventDefault(),T},b=()=>{const p=Math.abs(g.value-m.value),T=Math.abs(y.value-l.value);return p>=P||T>=P?p>T?g.value-m.value>0?"left":"right":y.value-l.value>0?"up":"down":null};return{onTouchStart:a,onTouchEnd:c}}const Le={class:"popup"},Ve={class:"btn-container"},Ye=K({__name:"ConfirmationPopup",emits:["confirmed"],setup(P,{emit:g}){const y=g;function m(){y("confirmed",!1)}function l(){y("confirmed",!0)}return(a,c)=>(i(),J(_e,{onClose:m},{default:E(()=>[n("div",Le,[Ue(a.$slots,"default",{},void 0,!0),n("div",Ve,[S(F,{onClick:l,type:"primary"},{default:E(()=>c[0]||(c[0]=[M("Confirm")])),_:1}),S(F,{onClick:m,type:"primary"},{default:E(()=>c[1]||(c[1]=[M("Cancel")])),_:1})])])]),_:3}))}}),Je=Z(Ye,[["__scopeId","data-v-e6431455"]]),Re={class:"event-popup"},Xe={class:"event-title"},ze={class:"event-group"},We={class:"event-date"},Ke={key:0,class:"event-date"},Ze={class:"event-description"},He={key:1,class:"btn-container task"},je={key:2,class:"btn-container event"},Qe={class:"event-group"},et=K({__name:"EventPopup",props:{event:{},group_id:{}},emits:["close"],setup(P,{emit:g}){const y="https://syntra-20242025-henk-api.onrender.com",{deleteData:m}=De(),l=ce(),a=P,c=g,b=r(!1),p=r(!1),T=r(!1),I=r(""),d=r(null),$=r(""),x=()=>{if(!a.event)return;const u={id:String(a.event.id),title:a.event.title,description:a.event.description,groupId:a.event.groupId,start:a.event.startDate,end:a.event.endDate,startTime:a.event.startTime,endTime:a.event.endTime,group_id:a.group_id};l.push({name:"calenderEvents",query:u})},f=async()=>{const u=await m(`${y}/events/${a.event.id}`);if(W(u)){d.value=u.status,I.value=u.message,$.value="Unable to delete event.",T.value=!0,d.value===401&&l.push({name:"login"});return}b.value=!1,p.value=!0};function O(u){u&&f(),b.value=!1}const R=()=>{const u={...l.currentRoute.value.query};u.reload=Date.now().toString(),l.push({name:"calendar",query:u}),c("close")};function H(){l.push({name:"todo_tasks"})}return(u,s)=>(i(),_(G,null,[S(_e,{onClose:s[3]||(s[3]=Y=>c("close"))},{default:E(()=>[n("div",Re,[n("div",Xe,v(u.event.title),1),n("div",ze,v(u.event.displayName),1),n("div",We,v(u.event.startDate)+" "+v(u.event.startTime),1),u.event.eventType!=="task"?(i(),_("div",Ke,v(u.event.endDate)+" "+v(u.event.endTime),1)):L("",!0),n("div",Ze,[n("div",null,v(u.event.description),1)]),u.event.eventType==="task"?(i(),_("div",He,[S(F,{onClick:H,type:"primary"},{default:E(()=>s[5]||(s[5]=[M("View Tasks")])),_:1}),S(F,{onClick:s[0]||(s[0]=Y=>c("close")),type:"primary"},{default:E(()=>s[6]||(s[6]=[M("Cancel")])),_:1})])):(i(),_("div",je,[S(F,{onClick:x,type:"save"},{default:E(()=>s[7]||(s[7]=[M("Edit")])),_:1}),S(F,{onClick:s[1]||(s[1]=Y=>c("close")),type:"primary"},{default:E(()=>s[8]||(s[8]=[M("Cancel")])),_:1}),S(F,{onClick:s[2]||(s[2]=Y=>b.value=!0),type:"negative"},{default:E(()=>s[9]||(s[9]=[M("Delete")])),_:1})]))])]),_:1}),b.value?(i(),J(Je,{key:0,onConfirmed:O},{default:E(()=>[s[10]||(s[10]=n("p",null,"Are you sure you want to delete the event:",-1)),n("p",Qe,v(u.event.title),1)]),_:1})):L("",!0),p.value?(i(),J(Ge,{key:1,onClose:R},{default:E(()=>s[11]||(s[11]=[n("p",null,"Event deleted",-1)])),_:1})):L("",!0),T.value?(i(),J(ge,{key:2,errorExplanation:$.value,errorStatus:d.value,errorMessage:I.value,onClose:s[4]||(s[4]=Y=>T.value=!1)},null,8,["errorExplanation","errorStatus","errorMessage"])):L("",!0)],64))}}),tt=Z(et,[["__scopeId","data-v-8ac107e9"]]),nt={class:"line"},ot={class:"expand-button"},at={class:"event-selected-date"},st={class:"event-container"},rt={key:0},lt=["onClick"],ut={key:0},it={class:"event-date-range"},ct={class:"event-details"},dt={class:"display-group-name"},vt={key:1},pt=K({__name:"ExpandableDiv",props:{events:{},selectedDate:{},group_id:{}},setup(P){const{onTouchStart:g,onTouchEnd:y}=he(),m=r(null),l=r(!1),a=P,c=r(!1),b=()=>{c.value=!c.value},p=xe(()=>{var d;return(d=a.selectedDate)!=null&&d.events?a.selectedDate.events:[]}),T=d=>{m.value=d,l.value=!0},I=()=>{m.value=null,l.value=!1};return(d,$)=>{var x;return i(),_(G,null,[n("div",{class:oe(["expand-wrapper",c.value?"expanded":"minimized"]),onClick:b,onTouch:b,onTouchstart:$[0]||($[0]=(...f)=>V(g)&&V(g)(...f)),onTouchend:$[1]||($[1]=f=>{const O=V(y)(f);O==="up"?c.value=!0:O==="down"&&(c.value=!1)})},[n("div",nt,[n("button",ot,v(c.value?"▼":"▲"),1)]),n("div",at,v((x=a.selectedDate)==null?void 0:x.date),1),n("div",st,[p.value.length?(i(),_("ul",rt,[(i(!0),_(G,null,ne(p.value,(f,O)=>(i(),_("li",{key:O,class:"event-item",onClick:Oe(R=>T(f),["stop"])},[f.startDate!==f.endDate?(i(),_("div",ut,[n("div",it,v(f.startDate)+" - "+v(f.endDate),1)])):L("",!0),n("div",ct,[n("div",{class:oe(["event-circle",f.eventType])},null,2),n("span",null,[M(v(f.startTime)+" - "+v(f.endTime)+" ",1),n("span",dt,v(f.displayName),1),M(" "+v(f.title),1)])])],8,lt))),128))])):(i(),_("p",vt,"Nothing planned on this day."))])],34),m.value?(i(),J(tt,{key:0,event:m.value,group_id:d.group_id,onClose:I},null,8,["event","group_id"])):L("",!0)],64)}}}),mt=Z(pt,[["__scopeId","data-v-9dd66a3f"]]),ft={class:"button-container"},yt={class:"small-icon"},gt=K({__name:"GroupNavigation",setup(P){const g=ce(),y=()=>{g.push({name:"Groups"})};return(m,l)=>{const a=Fe("font-awesome-icon");return i(),_("div",ft,[n("div",yt,[S(a,{class:"icon",icon:["fas","user-group"],onClick:y})])])}}}),Dt=Z(gt,[["__scopeId","data-v-4bc05388"]]),_t={class:"center"},ht={class:"group-calendar"},Tt={class:"calendar-wrapper"},Ct={class:"calendar-header"},$t={id:"month-year"},kt={class:"calendar-grid"},wt=["id","onClick"],Et={class:"event-lines"},St=K({__name:"CalendarView",setup(P){const g="https://syntra-20242025-henk-api.onrender.com",y=r(!1),m=r(""),l=r(null),a=r(""),{onTouchStart:c,onTouchEnd:b}=he(),{getData:p}=De(),T=Ae(),I=ce();let d="personal";const $=T.query.group_id;typeof $=="string"?d=$:Array.isArray($)&&(d=$[0]??"personal");const x=r(""),f=async()=>{if(x.value="Personal",d!=="personal"){const t=await p(`${g}/groups/${d}`);if(W(t))return;x.value=t.name}},O={timeZone:"Europe/Brussels",dateTimeNotation:"en-GB",hour12Notation:!1,hourNotation:"2-digit",minuteNotation:"2-digit",dayNotation:"2-digit",monthNotation:"long",yearNotation:"numeric"},{timeZone:R,dateTimeNotation:H,hour12Notation:u,hourNotation:s,minuteNotation:Y,dayNotation:Te,monthNotation:Ce,yearNotation:$e}=O,A=r([]),X=r(null),ae=new Date,z=r(ae.getUTCFullYear()),U=r(ae.getUTCMonth());r(ae.getUTCDate());const j=r({}),ke=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],we=["January","February","March","April","May","June","July","August","September","October","November","December"],se=t=>new Date(t??new Date().toISOString()).toLocaleDateString(H,{timeZone:R,year:$e,month:Ce,day:Te}),Ee=t=>new Date(t??new Date().toISOString()).toLocaleTimeString(H,{timeZone:R,hour:s,minute:Y,hour12:u}),de=t=>{const e=t??new Date().toISOString(),o=se(e),D=Ee(e);return{date:o,time:D}},Q=async()=>{const t=z.value,e=U.value,o=`${t}-${e}`;if(j.value[o])A.value=j.value[o];else{const D=new Date(Date.UTC(t,e-1,1)).toISOString().split("T")[0],k=new Date(Date.UTC(t,e+2,0)).toISOString().split("T")[0];try{const C=[];if(d=="personal"){const h=await p(`${g}/events/personal?from=${D}&to=${k}`);W(h)?(l.value=h.status,m.value=h.message,a.value="Unable to load personal events.",y.value=!0,l.value===401&&I.push({name:"login"})):h.forEach(N=>{C.push({...N,eventType:"personal"})});const w=await p(`${g}/tasks?completed=false`);W(w)?(l.value=w.status,m.value=w.message,a.value="Unable to load tasks.",y.value=!0,l.value===401&&I.push({name:"login"})):w.forEach(N=>{N.start=N.dueDate,N.end=N.dueDate,C.push({...N,eventType:"task",displayName:"Task"})})}const q=d!="personal"?`groupId=${d}&`:"",B=await p(`${g}/events?${q}from=${D}&to=${k}`);W(B)?(l.value=B.status,m.value=B.message,a.value="Unable to load group events.",y.value=!0,l.value===401&&I.push({name:"login"})):B.forEach(h=>{C.push({...h,eventType:"group",displayName:`${h.Group.name}`})});const ee=[];C.forEach(h=>{const{date:w,time:N}=de(h.start),{date:le,time:te}=de(h.end);ee.push({...h,startDate:w,startTime:N,endDate:le,endTime:te})}),A.value=[...ee],j.value[o]=A.value,A.value.sort((h,w)=>new Date(h.start)>new Date(w.start)?1:-1)}catch(C){console.error("Error fetching and processing events:",C)}}re.value=ve(),Ne(),be()},Se=t=>{let e=[];return A.value.forEach(o=>{const D=new Date(t),k=new Date(o.startDate),C=new Date(o.endDate);if(D>=k&&D<=C){const q=o.eventType;e.includes(q)||e.push(q)}}),e},ve=()=>{const t=z.value,e=U.value,o=se(),D=new Date(Date.UTC(t,e+1,0)).getDate(),k=new Date(Date.UTC(t,e,0)).getDate(),C=new Date(Date.UTC(t,e,1)).getDay(),q=C===0?6:C-1,B=new Date(Date.UTC(t,e+1,0)).getDay(),ee=B===0?0:7-B,h=[],w=(N,le,te,Pe)=>{for(let ue=0;ue<N;ue++){const ye=le+ue,Ie=new Date(Date.UTC(t,e+Pe,ye)),ie=se(Ie.toISOString());h.push({day:ye,date:ie,faded:te,isToday:!te&&ie===o,eventLines:Se(ie)})}};return w(q,k-q+1,!0,-1),w(D,1,!1,0),w(ee,1,!0,1),h},re=r(ve()),be=()=>{requestAnimationFrame(()=>{const t=document.querySelector(".calendar");if(t){const e=t.getBoundingClientRect();document.documentElement.style.setProperty("--calendar-top",`${e.top-8}px`),document.documentElement.style.setProperty("--calendar-bottom",`${e.bottom+10}px`)}})},Ne=()=>{const t=re.value.find(e=>e.isToday);t&&fe(t)},pe=()=>{U.value=(U.value-1+12)%12,U.value===11&&z.value--,Q()},me=()=>{U.value=(U.value+1)%12,U.value===0&&z.value++,Q()},fe=t=>{const e=[];A.value.forEach(o=>{const D=new Date(o.startDate),k=new Date(o.endDate),C=new Date(t.date);C>=D&&C<=k&&e.push(o)}),X.value={...t,events:e}},Me=()=>{var e;const t={};(e=X.value)!=null&&e.date&&(t.selectedDate=X.value.date),d&&(t.group_id=d),I.push({name:"calenderEvents",query:t})};return qe(()=>T.query.reload,async()=>{j.value={},await f(),Q()}),Be(async()=>{await f(),Q()}),(t,e)=>(i(),_(G,null,[S(Dt),n("div",_t,[n("div",ht,v(x.value),1),n("div",Tt,[n("div",{class:"calendar",onTouchstart:e[0]||(e[0]=(...o)=>V(c)&&V(c)(...o)),onTouchend:e[1]||(e[1]=o=>{const D=V(b)(o);D==="right"&&pe(),D==="left"&&me()})},[n("div",Ct,[n("button",{onClick:pe,class:"nav-button"},"◀"),n("span",$t,v(we[U.value])+" "+v(z.value),1),n("button",{onClick:me,class:"nav-button"},"▶")]),n("div",kt,[(i(),_(G,null,ne(ke,o=>n("div",{key:o,class:"day"},v(o),1)),64)),(i(!0),_(G,null,ne(re.value,o=>{var D;return i(),_("div",{key:o.date,id:o.date,class:oe(["date",{faded:o.faded,today:o.isToday},{"selected-day":((D=X.value)==null?void 0:D.date)===o.date}]),onClick:k=>fe(o)},[n("span",null,v(o.day),1),n("div",Et,[(i(!0),_(G,null,ne(o.eventLines,k=>(i(),_("div",{key:k,class:oe(["event-line",k])},null,2))),128))])],10,wt)}),128))])],32),S(mt,{events:A.value,selectedDate:X.value,group_id:V(d)},null,8,["events","selectedDate","group_id"]),S(F,{type:"primary",class:"add-event-button",onClick:Me},{default:E(()=>e[3]||(e[3]=[M("Add event")])),_:1})])]),y.value?(i(),J(ge,{key:0,errorExplanation:a.value,errorStatus:l.value,errorMessage:m.value,onClose:e[2]||(e[2]=o=>y.value=!1)},null,8,["errorExplanation","errorStatus","errorMessage"])):L("",!0)],64))}}),xt=Z(St,[["__scopeId","data-v-c78493d4"]]);export{xt as default};
