import{g as s,d as K,m as J,w as S,a as n,N as Ie,b as N,f as P,o as u,_ as Z,c as D,F as G,h as L,e as ce,J as c,S as Ue,u as V,p as ne,K as te,T as xe,r as Oe,H as Fe,U as Ae,I as qe}from"./index-BZmOjIu1.js";import{E as ge,a as De,i as W}from"./ErrorPopup-C8aMxlhh.js";import{S as O}from"./StyledButton-CceZmSIf.js";import{P as _e}from"./PopUpComponent-D7kd4DBd.js";import{M as Be}from"./MessagePopup-C_81XLXa.js";import"./ErrorMessage-7kxkp75I.js";function he(I=50){const p=s(0),y=s(0),i=s(0),d=s(0),r=m=>{p.value=m.touches[0].clientX,y.value=m.touches[0].clientY},v=m=>{i.value=m.changedTouches[0].clientX,d.value=m.changedTouches[0].clientY;const _=w();return _&&m.preventDefault(),_},w=()=>{const m=Math.abs(p.value-i.value),_=Math.abs(y.value-d.value);return m>=I||_>=I?m>_?p.value-i.value>0?"left":"right":y.value-d.value>0?"up":"down":null};return{onTouchStart:r,onTouchEnd:v}}const Ge={class:"popup"},Le={class:"btn-container"},Ve=K({__name:"ConfirmationPopup",emits:["confirmed"],setup(I,{emit:p}){const y=p;function i(){y("confirmed",!1)}function d(){y("confirmed",!0)}return(r,v)=>(u(),J(_e,{onClose:i},{default:S(()=>[n("div",Ge,[Ie(r.$slots,"default",{},void 0,!0),n("div",Le,[N(O,{onClick:d,type:"primary"},{default:S(()=>v[0]||(v[0]=[P("Confirm")])),_:1}),N(O,{onClick:i,type:"primary"},{default:S(()=>v[1]||(v[1]=[P("Cancel")])),_:1})])])]),_:3}))}}),Ye=Z(Ve,[["__scopeId","data-v-e6431455"]]),Je={class:"event-popup"},Re={class:"event-title"},Xe={class:"event-group"},ze={class:"event-date"},We={key:0,class:"event-date"},Ke={class:"event-description"},Ze={key:1,class:"btn-container task"},He={key:2,class:"btn-container event"},je={class:"event-group"},Qe=K({__name:"EventPopup",props:{event:{},group_id:{}},emits:["close"],setup(I,{emit:p}){const y="https://syntra-20242025-henk-api.onrender.com/api",{deleteData:i}=De(),d=ce(),r=I,v=p,w=s(!1),m=s(!1),_=s(!1),T=s(""),C=s(null),b=s(""),F=()=>{if(!r.event)return;const l={id:String(r.event.id),title:r.event.title,description:r.event.description,groupId:r.event.groupId,start:r.event.startDate,end:r.event.endDate,startTime:r.event.startTime,endTime:r.event.endTime,group_id:r.group_id};d.push({name:"calenderEvents",query:l})},f=async()=>{const l=await i(`${y}/events/${r.event.id}`);if(W(l)){C.value=l.status,T.value=l.message,b.value="Unable to delete event.",_.value=!0,C.value===401&&d.push({name:"login"});return}w.value=!1,m.value=!0};function U(l){l&&f(),w.value=!1}const R=()=>{const l={...d.currentRoute.value.query};l.reload=Date.now().toString(),d.push({name:"calendar",query:l}),v("close")};function ae(){d.push({name:"todo_tasks"})}return(l,o)=>(u(),D(G,null,[N(_e,{onClose:o[3]||(o[3]=Y=>v("close"))},{default:S(()=>[n("div",Je,[n("div",Re,c(l.event.title),1),n("div",Xe,c(l.event.displayName),1),n("div",ze,c(l.event.startDate)+" "+c(l.event.startTime),1),l.event.eventType!=="task"?(u(),D("div",We,c(l.event.endDate)+" "+c(l.event.endTime),1)):L("",!0),n("div",Ke,[n("div",null,c(l.event.description),1)]),l.event.eventType==="task"?(u(),D("div",Ze,[N(O,{onClick:ae,type:"primary"},{default:S(()=>o[5]||(o[5]=[P("View Tasks")])),_:1}),N(O,{onClick:o[0]||(o[0]=Y=>v("close")),type:"primary"},{default:S(()=>o[6]||(o[6]=[P("Cancel")])),_:1})])):(u(),D("div",He,[N(O,{onClick:F,type:"save"},{default:S(()=>o[7]||(o[7]=[P("Edit")])),_:1}),N(O,{onClick:o[1]||(o[1]=Y=>v("close")),type:"primary"},{default:S(()=>o[8]||(o[8]=[P("Cancel")])),_:1}),N(O,{onClick:o[2]||(o[2]=Y=>w.value=!0),type:"negative"},{default:S(()=>o[9]||(o[9]=[P("Delete")])),_:1})]))])]),_:1}),w.value?(u(),J(Ye,{key:0,onConfirmed:U},{default:S(()=>[o[10]||(o[10]=n("p",null,"Are you sure you want to delete the event:",-1)),n("p",je,c(l.event.title),1)]),_:1})):L("",!0),m.value?(u(),J(Be,{key:1,onClose:R},{default:S(()=>o[11]||(o[11]=[n("p",null,"Event deleted",-1)])),_:1})):L("",!0),_.value?(u(),J(ge,{key:2,errorExplanation:b.value,errorStatus:C.value,errorMessage:T.value,onClose:o[4]||(o[4]=Y=>_.value=!1)},null,8,["errorExplanation","errorStatus","errorMessage"])):L("",!0)],64))}}),et=Z(Qe,[["__scopeId","data-v-8ac107e9"]]),tt={class:"line"},nt={class:"expand-button"},at={class:"event-selected-date"},ot={class:"event-container"},st={key:0},rt=["onClick"],lt={key:0},ut={class:"event-date-range"},it={class:"event-details"},ct={class:"display-group-name"},dt={key:1},vt=K({__name:"ExpandableDiv",props:{events:{},selectedDate:{},group_id:{}},setup(I){const{onTouchStart:p,onTouchEnd:y}=he(),i=s(null),d=s(!1),r=I,v=s(!1),w=()=>{v.value=!v.value},m=Ue(()=>{var C;return(C=r.selectedDate)!=null&&C.events?r.selectedDate.events:[]}),_=C=>{i.value=C,d.value=!0},T=()=>{i.value=null,d.value=!1};return(C,b)=>{var F;return u(),D(G,null,[n("div",{class:ne(["expand-wrapper",v.value?"expanded":"minimized"]),onClick:w,onTouch:w,onTouchstart:b[0]||(b[0]=(...f)=>V(p)&&V(p)(...f)),onTouchend:b[1]||(b[1]=f=>{const U=V(y)(f);U==="up"?v.value=!0:U==="down"&&(v.value=!1)})},[n("div",tt,[n("button",nt,c(v.value?"▼":"▲"),1)]),n("div",at,c((F=r.selectedDate)==null?void 0:F.date),1),n("div",ot,[m.value.length?(u(),D("ul",st,[(u(!0),D(G,null,te(m.value,(f,U)=>(u(),D("li",{key:U,class:"event-item",onClick:xe(R=>_(f),["stop"])},[f.startDate!==f.endDate?(u(),D("div",lt,[n("div",ut,c(f.startDate)+" - "+c(f.endDate),1)])):L("",!0),n("div",it,[n("div",{class:ne(["event-circle",f.eventType])},null,2),n("span",null,[P(c(f.startTime)+" - "+c(f.endTime)+" ",1),n("span",ct,c(f.displayName),1),P(" "+c(f.title),1)])])],8,rt))),128))])):(u(),D("p",dt,"Nothing planned on this day."))])],34),i.value?(u(),J(et,{key:0,event:i.value,group_id:C.group_id,onClose:T},null,8,["event","group_id"])):L("",!0)],64)}}}),pt=Z(vt,[["__scopeId","data-v-9dd66a3f"]]),mt={class:"button-container"},ft={class:"small-icon"},yt=K({__name:"GroupNavigation",setup(I){const p=ce(),y=()=>{p.push({name:"Groups"})};return(i,d)=>{const r=Oe("font-awesome-icon");return u(),D("div",mt,[n("div",ft,[N(r,{class:"icon",icon:["fas","user-group"],onClick:y})])])}}}),gt=Z(yt,[["__scopeId","data-v-4bc05388"]]),Dt={class:"center"},_t={class:"group-calendar"},ht={class:"calendar-wrapper"},Tt={class:"calendar-header"},Ct={id:"month-year"},wt={class:"calendar-grid"},Et=["id","onClick"],kt={class:"event-lines"},$t=K({__name:"CalendarView",setup(I){const p=s(!1),y=s(""),i=s(null),d=s(""),{onTouchStart:r,onTouchEnd:v}=he(),{getData:w}=De(),m=Fe(),_=ce();let T="personal";const C=m.query.group_id;typeof C=="string"?T=C:Array.isArray(C)&&(T=C[0]??"personal");const b=s(""),F=async()=>{if(b.value="Personal",T!=="personal"){const t=await w(`/api/groups/${T}`);if(W(t))return;b.value=t.name}},f={timeZone:"Europe/Brussels",dateTimeNotation:"en-GB",hour12Notation:!1,hourNotation:"2-digit",minuteNotation:"2-digit",dayNotation:"2-digit",monthNotation:"long",yearNotation:"numeric"},{timeZone:U,dateTimeNotation:R,hour12Notation:ae,hourNotation:l,minuteNotation:o,dayNotation:Y,monthNotation:Te,yearNotation:Ce}=f,A=s([]),X=s(null),oe=new Date,z=s(oe.getUTCFullYear()),x=s(oe.getUTCMonth());s(oe.getUTCDate());const H=s({}),we=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],Ee=["January","February","March","April","May","June","July","August","September","October","November","December"],se=t=>new Date(t??new Date().toISOString()).toLocaleDateString(R,{timeZone:U,year:Ce,month:Te,day:Y}),ke=t=>new Date(t??new Date().toISOString()).toLocaleTimeString(R,{timeZone:U,hour:l,minute:o,hour12:ae}),de=t=>{const e=t??new Date().toISOString(),a=se(e),g=ke(e);return{date:a,time:g}},j=async()=>{const t=z.value,e=x.value,a=`${t}-${e}`;if(H.value[a])A.value=H.value[a];else{const g=new Date(Date.UTC(t,e-1,1)).toISOString().split("T")[0],k=new Date(Date.UTC(t,e+2,0)).toISOString().split("T")[0];try{const E=[];if(T=="personal"){const h=await w(`/api/events/personal?from=${g}&to=${k}`);W(h)?(i.value=h.status,y.value=h.message,d.value="Unable to load personal events.",p.value=!0,i.value===401&&_.push({name:"login"})):h.forEach(M=>{E.push({...M,eventType:"personal"})});const $=await w("/api/tasks?completed=false");W($)?(i.value=$.status,y.value=$.message,d.value="Unable to load tasks.",p.value=!0,i.value===401&&_.push({name:"login"})):$.forEach(M=>{M.start=M.dueDate,M.end=M.dueDate,E.push({...M,eventType:"task",displayName:"Task"})})}const q=T!="personal"?`groupId=${T}&`:"",B=await w(`/api/events?${q}from=${g}&to=${k}`);W(B)?(i.value=B.status,y.value=B.message,d.value="Unable to load group events.",p.value=!0,i.value===401&&_.push({name:"login"})):B.forEach(h=>{E.push({...h,eventType:"group",displayName:`${h.Group.name}`})});const Q=[];E.forEach(h=>{const{date:$,time:M}=de(h.start),{date:le,time:ee}=de(h.end);Q.push({...h,startDate:$,startTime:M,endDate:le,endTime:ee})}),A.value=[...Q],H.value[a]=A.value,A.value.sort((h,$)=>new Date(h.start)>new Date($.start)?1:-1)}catch(E){console.error("Error fetching and processing events:",E)}}re.value=ve(),Ne(),Se()},$e=t=>{let e=[];return A.value.forEach(a=>{const g=new Date(t),k=new Date(a.startDate),E=new Date(a.endDate);if(g>=k&&g<=E){const q=a.eventType;e.includes(q)||e.push(q)}}),e},ve=()=>{const t=z.value,e=x.value,a=se(),g=new Date(Date.UTC(t,e+1,0)).getDate(),k=new Date(Date.UTC(t,e,0)).getDate(),E=new Date(Date.UTC(t,e,1)).getDay(),q=E===0?6:E-1,B=new Date(Date.UTC(t,e+1,0)).getDay(),Q=B===0?0:7-B,h=[],$=(M,le,ee,Me)=>{for(let ue=0;ue<M;ue++){const ye=le+ue,Pe=new Date(Date.UTC(t,e+Me,ye)),ie=se(Pe.toISOString());h.push({day:ye,date:ie,faded:ee,isToday:!ee&&ie===a,eventLines:$e(ie)})}};return $(q,k-q+1,!0,-1),$(g,1,!1,0),$(Q,1,!0,1),h},re=s(ve()),Se=()=>{requestAnimationFrame(()=>{const t=document.querySelector(".calendar");if(t){const e=t.getBoundingClientRect();document.documentElement.style.setProperty("--calendar-top",`${e.top-8}px`),document.documentElement.style.setProperty("--calendar-bottom",`${e.bottom+10}px`)}})},Ne=()=>{const t=re.value.find(e=>e.isToday);t&&fe(t)},pe=()=>{x.value=(x.value-1+12)%12,x.value===11&&z.value--,j()},me=()=>{x.value=(x.value+1)%12,x.value===0&&z.value++,j()},fe=t=>{const e=[];A.value.forEach(a=>{const g=new Date(a.startDate),k=new Date(a.endDate),E=new Date(t.date);E>=g&&E<=k&&e.push(a)}),X.value={...t,events:e}},be=()=>{var e;const t={};(e=X.value)!=null&&e.date&&(t.selectedDate=X.value.date),T&&(t.group_id=T),_.push({name:"calenderEvents",query:t})};return Ae(()=>m.query.reload,async()=>{H.value={},await F(),j()}),qe(async()=>{await F(),j()}),(t,e)=>(u(),D(G,null,[N(gt),n("div",Dt,[n("div",_t,c(b.value),1),n("div",ht,[n("div",{class:"calendar",onTouchstart:e[0]||(e[0]=(...a)=>V(r)&&V(r)(...a)),onTouchend:e[1]||(e[1]=a=>{const g=V(v)(a);g==="right"&&pe(),g==="left"&&me()})},[n("div",Tt,[n("button",{onClick:pe,class:"nav-button"},"◀"),n("span",Ct,c(Ee[x.value])+" "+c(z.value),1),n("button",{onClick:me,class:"nav-button"},"▶")]),n("div",wt,[(u(),D(G,null,te(we,a=>n("div",{key:a,class:"day"},c(a),1)),64)),(u(!0),D(G,null,te(re.value,a=>{var g;return u(),D("div",{key:a.date,id:a.date,class:ne(["date",{faded:a.faded,today:a.isToday},{"selected-day":((g=X.value)==null?void 0:g.date)===a.date}]),onClick:k=>fe(a)},[n("span",null,c(a.day),1),n("div",kt,[(u(!0),D(G,null,te(a.eventLines,k=>(u(),D("div",{key:k,class:ne(["event-line",k])},null,2))),128))])],10,Et)}),128))])],32),N(pt,{events:A.value,selectedDate:X.value,group_id:V(T)},null,8,["events","selectedDate","group_id"]),N(O,{type:"primary",class:"add-event-button",onClick:be},{default:S(()=>e[3]||(e[3]=[P("Add event")])),_:1})])]),p.value?(u(),J(ge,{key:0,errorExplanation:d.value,errorStatus:i.value,errorMessage:y.value,onClose:e[2]||(e[2]=a=>p.value=!1)},null,8,["errorExplanation","errorStatus","errorMessage"])):L("",!0)],64))}}),Ut=Z($t,[["__scopeId","data-v-198f8f9d"]]);export{Ut as default};
